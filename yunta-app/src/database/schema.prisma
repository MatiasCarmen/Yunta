// ============================================
// YUNTA - Prisma Schema
// ============================================
// Sistema de Gesti贸n Financiera Familiar
// Stack: PostgreSQL + Prisma + Next.js
// ============================================

generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================
//  ENUMS - Tipos de Datos
// ============================================

/// Roles de usuario en el sistema YUNTA
enum Role {
  BENEFICIARIO  // Solo consultan y gastan (ej: hijos, familiares)
  GESTOR        // Consultan, gastan y ven reportes (ej: Tom谩s, Pilar)
  EJECUTIVO     // Control total + Gesti贸n de Juntas (ej: Mat铆as)
}

/// Estado del usuario en el sistema
enum UserStatus {
  ACTIVE        // Usuario activo
  INACTIVE      // Usuario desactivado temporalmente
  SUSPENDED     // Usuario suspendido por seguridad
}

// ============================================
//  MODELO: USER (Usuarios del Sistema)
// ============================================

/// Representa a los integrantes de la familia y gestores
model User {
  // ==========================================
  //  IDENTIFICACIN
  // ==========================================
  
  /// ID 煤nico del usuario (UUID)
  id        String   @id @default(uuid())
  
  /// Nombre completo del usuario
  name      String
  
  /// Email (opcional, para notificaciones)
  email     String?  @unique
  
  /// Tel茅fono (opcional, para contacto)
  phone     String?
  
  // ==========================================
  //  SEGURIDAD Y AUTENTICACIN
  // ==========================================
  
  /// Rol del usuario en el sistema
  role      Role     @default(BENEFICIARIO)
  
  /// PIN de 4-6 d铆gitos (hasheado con bcrypt)
  /// IMPORTANTE: Nunca almacenar en texto plano
  pinHash   String
  
  /// Estado del usuario
  status    UserStatus @default(ACTIVE)
  
  /// Intentos fallidos de login (para bloqueo de seguridad)
  failedLoginAttempts Int @default(0)
  
  /// ltima vez que se bloque贸 el usuario
  lastLockedAt DateTime?
  
  // ==========================================
  //  PERFIL
  // ==========================================
  
  /// URL del avatar del usuario
  avatar    String?
  
  /// Biograf铆a o descripci贸n corta
  bio       String?
  
  /// Fecha de nacimiento
  birthDate DateTime?
  
  // ==========================================
  //  AUDITORA
  // ==========================================
  
  /// Fecha de creaci贸n del registro
  createdAt DateTime @default(now())
  
  /// Fecha de 煤ltima actualizaci贸n
  updatedAt DateTime @updatedAt
  
  /// ltima vez que el usuario inici贸 sesi贸n
  lastLoginAt DateTime?
  
  // ==========================================
  //  RELACIONES
  // ==========================================
  // TODO: Agregar relaciones con:
  // - Transactions (transacciones realizadas)
  // - Meetings (juntas creadas o asistidas)
  // - ActionItems (tareas asignadas)
  
  // ==========================================
  //  NDICES Y CONSTRAINTS
  // ==========================================
  
  @@index([email])
  @@index([role])
  @@index([status])
  @@index([createdAt])
  @@map("users") // Nombre de la tabla en PostgreSQL
}

// ============================================
//  MODELOS DE DINERO (Pr贸ximamente)
// ============================================
// TODO: Transaction, Category, Budget, etc.

// ============================================
//  MODELOS DE JUNTAS (Pr贸ximamente)
// ============================================
// TODO: Meeting, ActionItem, Attendance, etc.

